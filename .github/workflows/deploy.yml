# .github/workflows/deploy.yml
name: Deploy Next.js Portfolio to GitHub Pages

on:
  push:
    branches:
      - dev # This workflow runs when you push changes to your 'dev' branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Necessary for the action to push to 'main'
      pages: write    # Good practice if you configure Pages via settings
      id-token: write # If using OIDC (usually not needed for basic setup)

    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Required for peaceiris/actions-gh-pages

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use your preferred Node.js version (e.g., 18, 20)
          cache: 'npm'       # Or 'yarn' if you use yarn

      - name: Install dependencies 🔧
        run: npm install # Or yarn install

      - name: Build Next.js 🏗️
        run: npm run build # This command creates the 'out' directory

      - name: Add .nojekyll file
        run: touch ./out/.nojekyll # Prevents GitHub Pages' Jekyll from ignoring _next/static

      - name: Deploy to GitHub Pages 🚀
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./out # Publishes the *contents* of the 'out' directory
          publish_branch: main # <<< CRITICAL: This pushes the 'out' contents to the 'main' branch
          # cname: yourcustomdomain.com # Uncomment and set if you have a custom domain